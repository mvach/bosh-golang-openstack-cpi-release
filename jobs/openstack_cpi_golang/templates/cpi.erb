#!/bin/bash

set -e

BOSH_JOBS_DIR=${BOSH_JOBS_DIR:-/var/vcap/jobs}
GOLANG_CPI_CALLS=("info")
REGEXP="\"method\":\"([^\"]*)\""

read STDIN

if [[ ${STDIN} =~ ${REGEXP} ]]
then
    for element in "${GOLANG_CPI_CALLS[@]}"
    do
        if [[ $element == ${BASH_REMATCH[1]} ]]
        then
            echo ${STDIN} | ${BOSH_JOBS_DIR}/openstack_cpi_golang/bin/cpi-golang
            exit $?
        fi
    done
    echo ${stdin} | ${BOSH_JOBS_DIR}/openstack_cpi_golang/bin/cpi-ruby
else
    echo "input stream is not defining a method"
    exit 1
fi











